<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}" class="h-100">

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}"> {% seo %}
</head>

<body class="d-flex flex-column h-100">
    <!-- style="position:relative" -->

    <header class="mb-5">
        {% include nav.html %}
    </header>

  {% assign config_paper = site.data[page.paper] %}
  {% assign config_figure = config_paper[page.figure] %}
  {% assign exhibit = config_figure.Exhibit %}

  <link rel="stylesheet" href="{{ '/assets/css/osd-exhibit.css' | relative_url }}">

    <div id="content" class="position-fixed w-100" style="top: 0;left: 0;">
        <div class="container-fluid">
            <div class="row">
                <div class="col px-0">
                    <div id="openseadragon1" class="openseadragon"></div>
                    <div id="legend" class="position-absolute text-white p-2 bg-trans" style="top: 4rem; right:1.5%">
                        <ul id="channel-legend" class="list-unstyled m-0"></ul>
                    </div>
                    <div class="container position-absolute bg-trans" style="width: 400px; left:1.5%; top: 4rem;">
                        <div class=row>
                            <div class="col-2" id="leftArrow">
                                <i class="fas fa-arrow-left" style="font-size: 50px"></i>
                            </div>
                            <div class="col-8">
                            <audio class="w-100" id="audioPlayer" src="" controls preload></audio>
                            </div>
                            <div class="col-2" id="rightArrow">
                                <i class="fas fa-arrow-right" style="font-size: 50px;"></i>
                            </div>
                        </div>
                        <div class="waypoint-content" id="viewer-waypoint">
                        </div>
                        <div>
                            <p id="channel-label" class="mb-1 font-weight-bold pt-2">Select a marker group:</p>
                            <div id="channel-groups" class="nav flex nav-pills"></div>
                            <p id="mask-label" class="mb-1 font-weight-bold pt-2">Add data layer:</p>
                            <div id="mask-layers" class="nav flex nav-pills">
                            </div>
                        </div>
                        <div>
                            <div id="story-container"></div>
                        </div>
                    </div>
                    <div id="viewer-tool" class="position-absolute bg-trans" style="right:1.5%; top: 40vh;">
                        <div class="btn-group-vertical">
                            <a class="btn text-light" id="zoom-home" href="#zoom-home">
                                <i class="fas fa-home"></i>
                            </a>
                            <a class="btn text-light" id="zoom-out" href="#zoom-out">
                                <i class="fas fa-search-minus"></i>
                            </a>
                            <a class="btn text-light" id="zoom-in" href="#zoom-in">
                                <i class="fas fa-search-plus"></i>
                            </a>
                            <span id="arrow-switch" class="nav-item arrow-switch">
                            <a class="btn" href="javascript:;">
                                <span class=""><i class="fas fa-location-arrow"></i></span>
                            </a>
                            </span>
                            <span id="lasso-switch" class="nav-item lasso-switch">
                            <a class="btn" href="javascript:;">
                                <span class=""><i class="fas fa-bullseye"></i></span>
                            </a>
                            </span>
                            <span id="draw-switch" class="nav-item draw-switch">
                            <a class="btn" href="javascript:;">
                                <span class=""><i class="fas fa-crosshairs"></i></span>
                            </a>
                            </span>
                            <a class="btn" id='duplicate-view'>
                                <span class=""><i class="fas fa-clone"></i></span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="d-none">
        <input type="file" id="file-upload" class="d-none" />
        <ul>
            <li class="nav-item rounded-0" id="proto-story-index">
                <a class="nav-link list-group-item-action font-weight-bold"></a>
            </li>
        </ul>

        <div id="arrow-overlay" class="arrow-overlay">
          <i class="fa fa-location-arrow" aria-hidden="true"></i>
        </div>

        <div class="tab-pane fade" id="proto-story" role="tabpanel">
            <div class="row no-gutters if-many-waypoint">
                <div class="col">
                    <div class="waypoint-indices list-group nav nav-pills">
                        <a role="tab" data-toggle="list" class="nav-link">
                            <span class="index-span"></span>
                            <span class="inset-icon float-right">
                                <i class="white fas fa-share fa-lg"></i><br>
                            </span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="row no-gutters">
                <div class="col border-top pt-4">
                    <div class="waypoint-content tab-content">
                        <div class="tab-pane fade"></div>
                        <div class="tab-pane fade">
                            <form class="form save_edits_form">
                                <div class="input-group">
                                    <div style="width: 100%; margin-bottom: 5px">
                                        <input class="form-control edit_name editable bg-dark text-white rounded-0 border-0" type="text">
                                        </input>
                                        <br>
                                        <textarea class="form-control edit_text editable bg-dark text-white rounded-0 border-0" rows="9">
                                        </textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="readme">
        </div>
    </div>


    <div id="password_modal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Minerva Password</h2>
                </div>
                <div class="modal-body">

                    <form class="form">
                        <div class="form-group">
                            <input type=password class="form-control" name="p">
                        </div>
                        <button type="submit" class="btn btn-primary">Enter</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <div id="edit_description_modal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content text-dark">
                <div class="modal-header">
                    <h2 class="modal-title m-0 h5">Region of Interest</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <form class="form">
                        <div class="form-group text-bold">
                            <label> Enter a description for the selected region. </label>
                            <textarea class="form-control" name="d" rows="4"></textarea>
                        </div>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Make Shareable Link</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="copy_link_modal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content text-dark">
                <div class="modal-header">
                    <h2 class="modal-title m-0 h5">Region of Interest</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="form">
                        <div class="input-group">
                            <input type="text" class="form-control" id="copy_link" name="copy_content" placeholder="Some path">
                            <span class="input-group-btn">
                                <button class="btn btn-default modal_copy_button" type="submit" data-toggle="tooltip" data-placement="bottom">
                                    Copy
                                </button>
                            </span>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div id="current-overlay-0" class="white overlay"></div>


    {% include scripts.html %}
    <script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js" integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.3.1/openseadragon.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.8.6/showdown.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script> 
    <script src="https://api.html5media.info/1.2.2/html5media.min.js"></script>

    <script>
        {% include polyfills.js %}
    </script>
    <script>
        {% include clipboard.js %}
    </script>
    <script>
        {% include js-yaml.min.js %}
    </script>
    <script>
        {% include lz-string.js %}
    </script>
    <script>
        {% include d3.min.js %}
    </script>
    <script>
        {% include openseadragon-svg-overlay.js %}
    </script>
    <script>
        {% include exhibits.js %}
    </script>
    <script>
        const exhibit = {{ exhibit | jsonify }};
        window.viewer = build_page(exhibit, {
          embedded: true
        });
    </script>
    <script>
        const makeTwinViewer = function(e) {
            var youngerWindow = window.open(window.location.href);
            var viewer1 = window.viewer;
            var viewer2;
            youngerWindow.addEventListener('DOMContentLoaded', (e) => {
                viewer2 = youngerWindow.viewer;
                console.log(youngerWindow.viewer);
                var viewer1Leading = false;
                var viewer2Leading = false;

                var viewer1Handler = function() {
                if (viewer2Leading) {
                    return;
                }

                viewer1Leading = true;
                viewer2.viewport.zoomTo(viewer1.viewport.getZoom());
                viewer2.viewport.panTo(viewer1.viewport.getCenter());
                viewer1Leading = false;
                };

                var viewer2Handler = function() {
                if (viewer1Leading) {
                    return;
                }

                viewer2Leading = true;
                viewer1.viewport.zoomTo(viewer2.viewport.getZoom());
                viewer1.viewport.panTo(viewer2.viewport.getCenter());
                viewer2Leading = false;
                };

                viewer1.addHandler('zoom', viewer1Handler);
                viewer2.addHandler('zoom', viewer2Handler);
                viewer1.addHandler('pan', viewer1Handler);
                viewer2.addHandler('pan', viewer2Handler);
            });
        };
        const duplicateViewButton = document.querySelector('#duplicate-view');
        duplicateViewButton.onclick = makeTwinViewer;
    </script>

<script>
        $('#story-board').on('hidden.bs.collapse', function() { 
            $('#js-story-collapse-indicator')[0].innerHTML = '<span class="px-2">SHOW MORE</span> <i class="fas fa-chevron-down"></i>'
        });
        $('#story-board').on('shown.bs.collapse', function() { 
            $('#js-story-collapse-indicator')[0].innerHTML = '<span class="px-2">SHOW LESS</span> <i class="fas fa-chevron-up"></i>'
        });
        
        
            // $('#scroll-bottom')
            //     .click(function(event) {
            //         event.preventDefault();
            //         $('aside').animate({
            //             scrollTop: $(window).height() * 0.65
            //         }, 500, "swing", function() {
            //             $('#scroll-bottom').addClass('d-none')
            //             Callback after animation
            //             Must change focus!
            //             var $target = $(target);
            //             $target.focus();
            //             if ($target.is(":focus")) { // Checking if the target was focused
            //                 return false;
            //             } else {
            //                 $target.attr('tabindex','-1'); // Adding tabindex for elements not focusable
            //                 $target.focus(); // Set focus again
            //             };
            //         });
            //     });

        // $(document).ready(function() {
        //     $('#osd-side-nav').scrollTop(0);
        //     topAnchor = $('#story-title').position().top;

        //     var storyTitleAdded = false;
        //     $('#osd-side-nav').scroll(function() {
        //         if ($('#story-title').position().top == topAnchor && $('#story-title-sticky')[0]) {
        //             $('#story-title-sticky')[0].parentNode.removeChild($('#story-title-sticky')[0]);
        //             storyTitleAdded = false;
        //         }
        //         if ($('#story-title').position().top < topAnchor && !storyTitleAdded) {
        //             var clNode = $('#story-title')[0].cloneNode(true);
        //             clNode.setAttribute('id', 'story-title-sticky');
        //             $('#story-title')[0].parentNode.insertBefore(clNode, $('#story-title')[0].nextSibling);
        //             $('#story-title-sticky')
        //                 .css('top', topAnchor)
        //                 .css('width', $('#story-title').width())
        //                 .addClass('border-bottom border-secondary')
        //             storyTitleAdded = true;
        //         }
        //     });
        // })

        $('.js-toggle-osd-side-nav').click(function() {
            $('#osd-side-nav').position().top == 0 
                ? $('#osd-side-nav').css('top', '75vh')
                : $('#osd-side-nav').css('top', 0);
            $('#osd-side-nav').scrollTop(0);
        })
    </script>
</body>

</html>
